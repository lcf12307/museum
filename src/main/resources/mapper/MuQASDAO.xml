<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.crtvu.dao.MuQASDAO">

    <select id="getQuotaIdCount" resultType="com.crtvu.dto.StrValue">
        select quota_id as str ,count(*) as value from quota where locate(#{year},year)>0 group by str
    </select>
    <select id="">
        select q.quota_id,a.year,count(*) from attachment a,quota q
        where a.type=2
        and a.name = q.name
        and a.year is not null
        and q.year is not null
        and locate(a.year,cast(q.year as char))>0
        group by q.quota_id,a.year ;
    </select>
    <select id="getAllMuseums" resultType="com.crtvu.entity.MuseumEntity">
        select * from museum.museum
        where year is not null and locate(#{year},year)>0
    </select>
    <delete id="deletePoint">
        DELETE FROM museum.point where <![CDATA[ year=#{year} AND type>=#{typeFrom} AND type <= #{typeTo} ]]>;
    </delete>
    <insert id="staticsTotal">
      INSERT INTO point (mid,name, year, type, point)
        SELECT
        mid,
        (select name from museum where id=p.mid) as name,
        year,
        2 AS type,
        sum(
            CASE WHEN type = 21
              THEN (point * 0.2)
            WHEN type = 22
              THEN (point * 0.2)
            WHEN type = 23
              THEN (point * 0.35)
            WHEN type = 24
              THEN (point * 0.15)
            WHEN type = 25
              THEN (point * 0.10)
            ELSE 0 END
        ) AS point
        FROM POINT p
        WHERE YEAR = #{year}
        GROUP BY mid
        ORDER BY mid;
    </insert>
    <select id="getDingXingScore" resultType="com.crtvu.entity.PointEntity">
        select id,mid,(select name from museum m where m.id= p.mid) as name,year,sum(point) as point,type from museum.point p
        where <![CDATA[ year=#{year} AND type>=#{typeFrom} AND type <= #{typeTo} ]]>
        <if test="museumName != null and museumName.trim() != ''">
            and name like CONCAT(CONCAT('%',#{museumName}),'%')
        </if>
          group by mid,type  order by type asc,mid asc
        <if test="orderString != null and orderString.trim() != ''">
             ,#{orderString}
        </if>
            ASC
    </select>
    <select id="getOneMuseumScore" resultType="com.crtvu.entity.PointEntity">
        select id,mid,name,year,cast(sum(point)/count(point) as DECIMAL(5,2)) as point,type from museum.point
        where <![CDATA[ mid=#{id} and year=#{year} AND type>=21 AND type <= 25 ]]> GROUP BY type
    </select>
    <select id="getAllMuseum" resultType="com.crtvu.entity.MuseumEntity">
        select * from museum where locate(#{year},year)>0 order by id
    </select>
    <select id="getTotalStatic" resultType="com.crtvu.entity.PointEntity">
        select * from museum.point where type=#{type} and year=#{year} and name=#{name}
    </select>
    <select id="getRank" resultType="com.crtvu.entity.PointEntity">
        select * from museum.point where type=2 and year=#{year} order by point desc
    </select>
    <select id="getDingXingRank" resultType="com.crtvu.entity.PointEntity">
        select * from museum.point WHERE  type = 40 and year = #{year} order by point ASC
    </select>
    <select id="findPointByid" resultType="com.crtvu.entity.PointEntity">
        select * from museum.point where id=#{id}
    </select>
</mapper>